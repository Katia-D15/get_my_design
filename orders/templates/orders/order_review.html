{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="border border-dark rounded p-4 mx-auto custom-max-width mb-5">
    <div class="row">
        <div class="col-12 col-sm-10 col-md-8 mt-3 offset-sm-1 offset-md-2">
            <h2 class="mb-5">Order Review</h2>

            {% if editing %}
               <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p}}
                <p> Estimated price: £<span id="price-preview">0.00</span></p>
                <button class="btn btn-inicial" type="submit" name="action" value="save_edit">Save Changes</button>
               </form>
            {% else %}
                <div class="mb-4">
                    <p><strong>Design Type: </strong>{{ order.design_type|capfirst}}</p>
                    <p><strong>Size: </strong>{{ order.size|capfirst}}</p>
                    <p><strong>Description: </strong>{{ order.description }}</p>

                    {% if order.file_upload %}
                       <p><strong>File: </strong>
                        <a href="{{ order.file_upload.url }}" target="_blank" class="text-break"> {{ order.file_upload.name }}</a>
                        </p>
                    {% else %}
                       <p><strong>File(s): </strong>None</p>
                    {% endif %}
                </div>

                <p><strong>Price: £{{ order.price }}</strong></p>

                <form method="post">
                  {% csrf_token %}
                  <button class="btn btn-inicial m-1" type="submit" name="action" value="edit">Edit</button>
                  <button class="btn btn-inicial m-1" type="submit" name="action" value="cancel"
                   onclick="return confirm('Are you sure you want to cancel this order? This action cannot be undone.')">Cancel
                  </button>
                  <a href="{% url 'checkout' order.order_number %}" class="btn btn-inicial m-1"><span>Proceed to Payment</span></a>
                </form>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block postloadjs %}
{{ block.super }}
<script src="{% static 'js/automatic_price.js' %}"></script>
{% endblock %}